@model MovieDetailVM


@{
	ViewData["Title"] = "Movie Details";
}




<input asp-for="Movie.MovieID" hidden />
<div class="container">
	<!-- Section 1: Movie Information -->
	<section id="movie-info" class="row mb-5">

		<div class="col-md-4">
			<img src="@Model.Movie.MovieImage" alt="Movie Poster" class="img-fluid" />
		</div>
		<div class="col-md-8">
			<h1>@Model.Movie.Title</h1>
			<!--<p><strong>Director:</strong> Director Name</p> -->
			<!--<p><strong>Cast:</strong> Actor 1, Actor 2, Actor 3</p> -->
			<p><strong>Genre:</strong>  @Model.Movie.Genre</p>
			<p><strong>Duration:</strong>  @Model.Movie.Duration</p>
			<p><strong>Release Date:</strong>  @Model.Movie.ReleaseDate</p>
			<p>
				<strong>Synopsis:</strong> @Model.Movie.Synopsis
			</p>
			<p>
				<a href="@Model.Movie.TrailerLink"><i class="fa-solid fa-circle-play" style="color: white;"></i></a> Watch Trailer
			</p>

		</div>
	</section>




<input type="hidden" id="movieID" value="@ViewData["MovieID"]" />


	<div class="container mt-3 mb-4">
		<div class="row mb-3">
            <h2 class="text-center">Lịch Chiếu</h2>
			
			<div id="filterDates" class="col-12 d-flex justify-content-evenly flex-wrap mb-2"></div>

			<div class="d-flex justify-content-between align-items-center mb-2">
               <h2 class="text-center">Danh sách Rạp</h2>
				<div id="filterCities" class="small"></div>
			</div>

			<div id="movieDetails" class="col-8 mb-2 mx-auto"></div>

            <form asp-action="Index" method="get">
                <input type="hidden" name="showtimeId" id="selectedShowtime" value="0" />
                <input type="hidden" name="movieId" id="movieID" value="@ViewData["MovieID"]" />
                <button type="submit" class="btn btn-success">Render Seat</button>
            </form>



		
			</div>

		</div>
    <div class="mb-5"><h3 class="category-title text-center fw-bold">Seat Selection</h3></div>
    <div class="screen text-center mb-5 ">Screen</div>

    @if (Model.ShowtimeSeats.Any())
    {
        <div id="seatsContainer" class="mx-auto seat-grid-container">
            <form method="post" asp-action="SeatChosing">
                <input type="hidden" name="movieId" id="movieID" value="@ViewData["MovieID"]" />
                <input type="hidden" name="showtimeId" id="selectedShowtime" value="@TempData["ShowtimeID"]" />

                @foreach (var row in Model.ShowtimeSeats.GroupBy(seat => seat.Seat.SeatName.Substring(0, 1))) // Group by letter
                {
                    <div class="seat-row">
                        @foreach (var seat in row.OrderBy(s => int.Parse(s.Seat.SeatName.Substring(1)))) // Sort numerically
                        {
                            <div class="seat @(seat.Status == ShowtimeSeatStatus.Booked ? "booked" : "") @(seat.Status == ShowtimeSeatStatus.Maintenance ? "maintenance" : "")"
                                 data-seat-id="@seat.Seat.SeatID"
                                 data-seat-number="@seat.Seat.ColumnNumber"
                                 data-price="@seat.Price"
                                 data-seat-type="@seat.SeatType">

                                <button class="seat-button" type="submit" name="seatId" value="@seat.ShowtimeSeatID">
                                    <span>@seat.Seat.SeatName</span>
                                </button>
                            </div>
                        }
                    </div>
                }
            </form>
        </div>
    }
    else
    {
        <p class="text-center">Please select a showtime to view available seats.</p>
    }


    <div class="seat-guideline d-flex justify-content-center my-3">
        <div class="seat-legend">
            <div class="seat-example available"></div> <span>Available</span>
        </div>
        <div class="seat-legend">
            <div class="seat-example booked"></div> <span>Booked</span>
        </div>
        <div class="seat-legend">
            <div class="seat-example maintenance"></div> <span>Maintenance</span>
        </div>
    </div>










    <div class="row justify-content-center mt-5">
        <h2 class="text-center">Food</h2>

        @foreach (var item in Model.products)
        {
            <div class="col-md-4 d-flex justify-content-center">
                <div class="product-card d-flex align-items-center">
                    <img src="@(item.ProductImage ?? "/css/images/default-food.png")"
                         alt="@item.Name" class="product-img">
                    <div class="product-info">
                        <h4 class="food-name">@item.Name</h4>
                        <p>@item.Description</p>
                        <span class="price">@item.Price.ToString("N2") VND</span>
                        <div class="quantity d-flex justify-content-end">
                            <a asp-action="DecreaseQuantity" asp-route-productId="@item.ProductID" asp-route-movieId="@ViewData["MovieID"]" asp-route-showtimeId="@TempData["ShowtimeID"]" class="btn minus">-</a>
                            @* <span class="count mx-2">@item.Count</span> <!--  count not mapped in product --> *@
                            <a asp-action="IncreaseQuantity" asp-route-productId="@item.ProductID" asp-route-movieId="@ViewData["MovieID"]" asp-route-showtimeId="@TempData["ShowtimeID"]" class="btn plus">+</a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

  

   
        <div class="row align-items-center">
            <!-- Movie Details -->
            <div class="col-md-3">
                <p><strong>Movie:</strong> <span id="displayMovieName">@Model.Movie.Title</span></p>
            </div>

            <!-- Combined Food and Tickets Display -->
            <div class="col-md-3">
                <p><strong>Items:</strong> <span id="displayFood">None</span></p>
            </div>

            <!-- Countdown Timer -->
            <div class="col-md-3">
                <p><strong>Time expired:</strong> <span id="countdown">05:00</span></p>
            </div>

            <!-- Total Price -->
            <div class="col-md-2">
                <p><strong>Total:</strong> <span id="displayTotalPrice">0 VND</span></p>
            </div>

            <!-- Confirm Booking Button -->
            <div class="col-md-1">
                <button type="submit" class="btn btn-success">Confirm Booking</button>
            </div>
        </div>



   



@section Scripts {
	<script src="~/js/detail.js"></script>
	<link rel="stylesheet" href="~/css/detail.css" />
        <script>
          
            document.getElementById("booking-summary")?.classList.remove("d-none");
                   
           
        </script>
}



<style>

        /* Container to align rows properly */
        .seat-grid-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        /* Each row (A, B, C...) is displayed on one line */
        .seat-row {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        /* Seat container */
        .seat {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Seat button */
        /* Seat button with radial gradient */
        .seat-button {
            width: 100%;
            height: 100%;
            /* font-size: 1.4rem; */
            font-weight: bold;
            text-align: center;
            border: none;
            background: radial-gradient(circle at center, #001f3f, #001f3f); /* Dark blue to black gradient */
            color: white;
            border-radius: 10px;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

            /* Hover effect */
            .seat-button:hover {
                background: radial-gradient(circle at center, #003366, #001f3f); /* Slightly lighter gradient */
            }


            /* Consistent button width */
            .seat-button span {
                display: inline-block;
                min-width: 35px;
                text-align: center;
            }

        /* Booked & Maintenance Seats */
        .booked .seat-button {
            background-color: #dc3545;
            cursor: not-allowed;
        }

        .maintenance .seat-button {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        /* Styling for quantity buttons */
        .quantity .btn {
            background-color: #6c757d; /* Bootstrap gray */
            color: white;
            border: none;
            padding: 6px 12px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 5px;
            transition: background 0.2s, transform 0.1s;
        }

            /* Hover effect */
            .quantity .btn:hover {
                background-color: #5a6268; /* Slightly darker gray */
            }

            /* Active (pressed) effect */
            .quantity .btn:active {
                background-color: #495057; /* Darker gray */
                transform: scale(0.95);
            }

        /* Seat Guideline (Legend) */
        .seat-guideline {
            display: flex;
            gap: 20px;
        }

        .seat-legend {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .seat-example {
            width: 20px;
            height: 20px;
            border-radius: 5px;
        }

            /* Colors matching seat buttons */
            .seat-example.available {
                background: radial-gradient(circle at center, #001f3f, #001f3f); /* Dark blue to black gradient */
            }

            .seat-example.booked {
                background-color: #dc3545;
            }

            .seat-example.maintenance {
                background-color: #6c757d;
            }

</style>
